import{d as R,i as E,j as $,r as i,o as k,a as O,c as e,w as t,e as N,_ as q,l as P,k as I,u as S,K as F,F as z,g as B,C as L,m as V,p as X,f as G,b as w}from"./index-NQRkkFuC.js";const W={class:"user-management-container"},D="vertical",M=R({__name:"user",props:{id:{type:Number,required:!0},username:{type:String,required:!0},password:{type:String,required:!0},email:{type:String},userType:{type:String,required:!0}},setup(v){var m;const p=(m=E())==null?void 0:m.appContext.config.globalProperties,y=p==null?void 0:p.$base,d=v,a=$({id:d.id,username:d.username,password:d.password,email:d.email,is_superuser:d.userType});let b="";const h=document.cookie.split("; ").find(r=>r.startsWith("csrftoken="));h?b=h.split("=")[1]:console.error("CSRF token not found in cookies");const g=[{label:"普通用户",value:!1},{label:"管理员",value:!0}],x=()=>{fetch(y+"/api/user/"+a.id+"/",{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json","X-CSRFToken":b},body:JSON.stringify(a)}).then(r=>{r.ok&&console.log("yes!")}).catch(r=>{console.error(r)})};return(r,s)=>{const c=i("a-input"),o=i("a-form-item"),n=i("a-select"),l=i("a-button"),_=i("a-form"),K=i("a-card"),T=i("a-col"),j=i("a-row");return k(),O("div",W,[e(j,{type:"flex",justify:"center"},{default:t(()=>[e(T,{span:12},{default:t(()=>[e(K,{title:"用户管理"},{default:t(()=>[e(_,{model:a,onSubmit:x,layout:D},{default:t(()=>[e(o,{label:"用户名"},{default:t(()=>[e(c,{value:a.username,"onUpdate:value":s[0]||(s[0]=f=>a.username=f)},null,8,["value"])]),_:1}),e(o,{label:"邮箱"},{default:t(()=>[e(c,{value:a.email,"onUpdate:value":s[1]||(s[1]=f=>a.email=f)},null,8,["value"])]),_:1}),e(o,{label:"修改密码"},{default:t(()=>[e(c,{value:a.password,"onUpdate:value":s[2]||(s[2]=f=>a.password=f),type:"password"},null,8,["value"])]),_:1}),e(o,{label:"修改用户类型"},{default:t(()=>[e(n,{value:a.is_superuser,"onUpdate:value":s[3]||(s[3]=f=>a.is_superuser=f),options:g},null,8,["value"])]),_:1}),e(o,null,{default:t(()=>[e(l,{type:"primary","html-type":"submit"},{default:t(()=>[N("提交")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})]),_:1})])}}}),A=q(M,[["__scopeId","data-v-bba79592"]]),C=v=>(X("data-v-f10065f3"),v=v(),G(),v),H=C(()=>w("br",null,null,-1)),Q=C(()=>w("br",null,null,-1)),Y=C(()=>w("br",null,null,-1)),Z=C(()=>w("br",null,null,-1)),ee=C(()=>w("p",null,"删除文章",-1)),te=C(()=>w("p",null,"发布文章",-1)),oe={__name:"post",setup(v){var c;const p=(c=E())==null?void 0:c.appContext.config.globalProperties,y=p==null?void 0:p.$base,d=$({posts:[]}),a=$({title:"请在此输入标题",content:""});function b(o){var l;const n=(l=document.cookie.split("; ").find(_=>_.startsWith(`${o}=`)))==null?void 0:l.split("=")[1];return n?decodeURIComponent(n):null}const h=b("csrftoken"),g=b("username"),x=()=>{fetch(y+"/api/post/?page_size=10000&format=json").then(o=>{if(!o.ok)throw new Error("Network response was not ok");return o.json()}).then(o=>{d.posts=o.results}).catch(o=>{console.error("There was a problem with the fetch operation:",o)})};x();const m=P("first"),r=o=>{let n=y+"/api/post/",l="PUT";m.value!=="first"?n+=m.value+"/":l="POST",fetch(n,{method:l,credentials:"include",headers:{"Content-Type":"application/json","X-CSRFToken":h},body:JSON.stringify(o)}).then(_=>{if(!_.ok)throw new Error("Network response was not ok");return _.json()}).then(_=>{V.success("发布成功！"),x(),a.content="",a.title="请在此输入标题"}).catch(_=>{V.error("权限不足！")})},s=o=>{fetch(y+"/api/post/"+o+"/",{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json","X-CSRFToken":h}}).then(n=>{n.ok?V.success("删除成功"):V.error("权限不足")}).catch(n=>{console.error(n)})};return(o,n)=>{const l=i("a-input"),_=i("a-alert"),K=i("v-md-editor"),T=i("a-float-button"),j=i("a-tab-pane"),f=i("a-popover"),J=i("a-tabs");return k(),I(J,{activeKey:m.value,"onUpdate:activeKey":n[3]||(n[3]=u=>m.value=u),tabPosition:"left",style:{height:"100vh"},size:"small"},{default:t(()=>[e(j,{key:"first",tab:"开始写作",class:"tab",style:{padding:"20px 100px"}},{default:t(()=>[e(l,{value:a.title,"onUpdate:value":n[0]||(n[0]=u=>a.title=u),bordered:!1,size:"large"},null,8,["value"]),H,e(_,{message:"欢迎您！"+S(g),type:"info","close-text":"关闭"},null,8,["message"]),Q,e(K,{modelValue:a.content,"onUpdate:modelValue":n[1]||(n[1]=u=>a.content=u),height:"650px"},null,8,["modelValue"]),e(T,{shape:"square",onClick:n[2]||(n[2]=u=>r(a)),type:"primary",style:{right:"94px"}},{icon:t(()=>[e(S(F))]),_:1})]),_:1}),(k(!0),O(z,null,B(d.posts,u=>(k(),I(j,{key:u.id,tab:u.title,class:"tab",style:{padding:"20px 100px"}},{default:t(()=>[e(l,{value:u.title,"onUpdate:value":U=>u.title=U,bordered:!1,size:"large"},null,8,["value","onUpdate:value"]),Y,e(_,{message:"本文由"+u.authorname+"完成。欢迎您！"+S(g),type:"info","close-text":"关闭"},null,8,["message"]),Z,e(K,{modelValue:u.content,"onUpdate:modelValue":U=>u.content=U,height:"650px"},null,8,["modelValue","onUpdate:modelValue"]),e(f,null,{content:t(()=>[ee]),default:t(()=>[e(T,{type:"default",shape:"square",onClick:U=>s(u.id),style:{right:"94px"}},{icon:t(()=>[e(S(L))]),_:2},1032,["onClick"])]),_:2},1024),e(f,null,{content:t(()=>[te]),default:t(()=>[e(T,{shape:"square",onClick:U=>r(u),type:"primary",style:{right:"154px"}},{icon:t(()=>[e(S(F))]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["tab"]))),128))]),_:1},8,["activeKey"])}}},ne=q(oe,[["__scopeId","data-v-f10065f3"]]),ae="/api/user/?format=json",se=R({__name:"admin",setup(v){var m;const p=(m=E())==null?void 0:m.appContext.config.globalProperties,y=p==null?void 0:p.$base,d=P("1"),a=P(1),b=$({}),h=()=>{window.location.replace("/")};function g(){for(var r=document.cookie.split(";"),s=0;s<r.length;s++){var c=r[s],o=c.indexOf("="),n=o>-1?c.substr(0,o):c;document.cookie=n+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/"}window.location.replace("/")}return(async()=>{try{const r=await fetch(y+ae,{method:"GET",credentials:"include"});if(r.ok){const s=await r.json();Object.assign(b,s)}else console.error("Failed to fetch user data")}catch(r){console.error("Error fetching user data:",r)}})(),(r,s)=>{const c=i("a-tab-pane"),o=i("a-tabs"),n=i("a-button");return k(),I(o,{activeKey:d.value,"onUpdate:activeKey":s[1]||(s[1]=l=>d.value=l),tabPosition:"left",centered:"",style:{height:"100vh"}},{default:t(()=>[e(c,{key:"1",tab:"文章管理",class:"tab"},{default:t(()=>[e(ne)]),_:1}),e(c,{key:"2",tab:"用户管理","force-render":"",class:"tab"},{default:t(()=>[e(o,{activeKey:a.value,"onUpdate:activeKey":s[0]||(s[0]=l=>a.value=l),tabPosition:"left"},{default:t(()=>[(k(!0),O(z,null,B(b,l=>(k(),I(c,{key:l.id,tab:l.username,style:{height:"100vh"}},{default:t(()=>[e(A,{id:l.id,email:l.email,username:l.username,password:"",userType:l.is_superuser,class:"tab"},null,8,["id","email","username","userType"])]),_:2},1032,["tab"]))),128))]),_:1},8,["activeKey"])]),_:1}),e(c,{key:"3",tab:"退出登录","force-render":"",class:"quit"},{default:t(()=>[e(n,{onClick:h,style:{"margin-bottom":"40px"}},{default:t(()=>[N("回到首页")]),_:1}),e(n,{onClick:g},{default:t(()=>[N("退出登录")]),_:1})]),_:1})]),_:1},8,["activeKey"])}}}),re=q(se,[["__scopeId","data-v-2346d13e"]]);export{re as default};
