import{H as A,I,d as O,i as F,J as R,j as P,l as V,r as p,o as N,a as E,c as n,w as i,e as S,F as z,g as D,k as H,b as j,t as T,u as J,m as G,v as L,z as q}from"./index-b40mkWmg.js";import{U as W}from"./UserOutlined-2nhfFuD-.js";var U={exports:{}};(function(M,a){(function(u,f){M.exports=f()})(A,function(){return function(u,f,t){u=u||{};var c=f.prototype,v={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function s(o,r,e,l){return c.fromToBase(o,r,e,l)}t.en.relativeTime=v,c.fromToBase=function(o,r,e,l,y){for(var m,_,g,w=e.$locale().relativeTime||v,x=u.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],d=x.length,C=0;C<d;C+=1){var h=x[C];h.d&&(m=l?t(o).diff(e,h.d,!0):e.diff(o,h.d,!0));var k=(u.rounding||Math.round)(Math.abs(m));if(g=m>0,k<=h.r||!h.r){k<=1&&C>0&&(h=x[C-1]);var $=w[h.l];y&&(k=y(""+k)),_=typeof $=="string"?$.replace("%d",k):$(k,r,h.l,g);break}}if(r)return _;var B=g?w.future:w.past;return typeof B=="function"?B(_):B.replace("%s",_)},c.to=function(o,r){return s(o,r,this,!0)},c.from=function(o,r){return s(o,r,this)};var b=function(o){return o.$u?t.utc():t()};c.toNow=function(o){return this.to(b(this),o)},c.fromNow=function(o){return this.from(b(this),o)}}})})(U);var X=U.exports;const K=I(X),Q={class:"comment",style:{"margin-top":"20px",padding:"20px"}},Y=j("br",null,null,-1),Z=O({__name:"comments",props:{comments:{type:Array,required:!0},post:{type:Number,required:!0}},setup(M){var r;const a=(r=F())==null?void 0:r.appContext.config.globalProperties,u=a==null?void 0:a.$base;R.extend(K);const f=M,t=P({post:f.post,author:"",mail:"",content:""}),c=V(!1);let v="";const s=document.cookie.split("; ").find(e=>e.startsWith("csrftoken="));s?v=s.split("=")[1]:console.error("CSRF token not found in cookies");const b=u+"/api/comment/?format=json&post_id="+f.post+"/",o=()=>{fetch(b,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-CSRFToken":v},body:JSON.stringify(t)}).then(e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()}).then(e=>{e&&(G.success("发布成功！"),t.content="",t.author="",t.mail="",location.reload())}).catch(e=>{console.error(e)})};return(e,l)=>{const y=p("a-input"),m=p("a-form-item"),_=p("a-form"),g=p("a-textarea"),w=p("a-button"),x=p("a-comment");return N(),E("div",Q,[n(x,null,{content:i(()=>[n(_,{model:t,layout:"inline",style:{"justify-content":"center"}},{default:i(()=>[n(m,{label:"昵称",name:"author",rules:[{required:!0,message:"Please input your username!"}]},{default:i(()=>[n(y,{value:t.author,"onUpdate:value":l[0]||(l[0]=d=>t.author=d)},null,8,["value"])]),_:1}),n(m,{label:"邮箱",name:"email"},{default:i(()=>[n(y,{value:t.mail,"onUpdate:value":l[1]||(l[1]=d=>t.mail=d)},null,8,["value"])]),_:1})]),_:1},8,["model"]),Y,n(_,{model:t},{default:i(()=>[n(m,null,{default:i(()=>[n(g,{rows:3,value:t.content,"onUpdate:value":l[2]||(l[2]=d=>t.content=d),rules:[{require:!0}]},null,8,["value"])]),_:1}),n(m,null,{default:i(()=>[n(w,{"html-type":"submit",loading:c.value,type:"primary",onClick:o},{default:i(()=>[S(" Add Comment ")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),(N(!0),E(z,null,D(f.comments,d=>(N(),H(x,null,{author:i(()=>[j("a",null,T(d.author),1)]),avatar:i(()=>[n(J(W),{style:{"font-size":"25px","border-radius":"25px",border:"2px solid black",padding:"2px"}})]),content:i(()=>[j("p",null,T(d.content),1)]),_:2},1024))),256))])}}}),tt={style:{"overflow-y":"scroll",height:"100%"},class:"content",id:"content"},et={class:"page"},rt={__name:"page",async setup(M){var r;let a,u;const f=()=>document.getElementById("content"),t=(r=F())==null?void 0:r.appContext.config.globalProperties,c=t==null?void 0:t.$base,v=L(),s=P({post:{}}),b=v.params.id,o=c+"/api/post/"+b+"/?format=json";try{const e=([a,u]=q(()=>fetch(o)),a=await a,u(),a);if(!e.ok)throw new Error("Network response was not ok");const l=([a,u]=q(()=>e.json()),a=await a,u(),a);s.post=l}catch(e){console.log("There was a problem with the fetch request:",e)}return(e,l)=>{const y=p("a-typography-title"),m=p("a-divider"),_=p("v-md-preview"),g=p("a-back-top");return N(),E("div",tt,[n(y,{style:{"text-align":"center",margin:"100px"}},{default:i(()=>[S(T(s.post.title),1)]),_:1}),n(m,{orientation:"left"},{default:i(()=>[S(T(s.post.created_at.substring(0,10))+" - written by "+T(s.post.authorname),1)]),_:1}),j("div",null,[j("div",et,[n(_,{text:s.post.content},null,8,["text"]),n(g,{visibilityHeight:400,target:f})]),n(Z,{comments:s.post.comments,post:s.post.id},null,8,["comments","post"])])])}}};export{rt as default};
